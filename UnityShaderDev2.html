<!DOCTYPE HTML>
<html lang="">


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="Unity Surface Shader#2 - Create First Shader, Rhys&#39;s">
    <meta name="description" content="OverviewLast time, we’ve talked about what a surface shader is, and what ingredients assemble a surface shader. And this">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Unity Surface Shader#2 - Create First Shader | Rhys&#39;s</title>
    <link rel="icon" type="image/png" href="/logo1.png">

    <link rel="stylesheet" type="text/css" href="/libs/awesome/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/materialize/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/aos/aos.css">
    <link rel="stylesheet" type="text/css" href="/libs/animate/animate.min.css">
    <link rel="stylesheet" type="text/css" href="/libs/lightGallery/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    <style type="text/css">
        
        code[class*="language-"], pre[class*="language-"] {
            white-space: pre !important;
        }
        
    </style>

    <script src="/libs/jquery/jquery-2.2.0.min.js"></script>
<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>


<body>

<header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="/avatar2.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Rhys's</span>
                </a>
            </div>
            

<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>Home</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/categories" class="waves-effect waves-light">
            
            <i class="fa fa-bookmark"></i>
            
            <span>Categories</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/archives" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>Archives</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>About</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="Search"></i>
        </a>
    </li>
</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="/avatar2.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Rhys's</div>
        <div class="logo-desc">
            
            Do my best, so I cannot blame myself for anything.
            
        </div>
    </div>

    

    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                Home
            </a>
        </li>
        
        <li>
            <a href="/categories" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-bookmark"></i>
                
                Categories
            </a>
        </li>
        
        <li>
            <a href="/archives" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                Archives
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                About
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/PokhoOfSCUT" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul>
</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/PokhoOfSCUT" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>





<div class="bg-cover pd-header post-cover" style="background-image: url('https://ww1.yunjiexi.club/2019/07/30/nRzLN.png')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        Unity Surface Shader#2 - Create First Shader
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="/libs/tocbot/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        <!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/Unity/" target="_blank">
                                <span class="chip bg-color">Unity</span>
                            </a>
                        
                            <a href="/tags/Unity-Shader/" target="_blank">
                                <span class="chip bg-color">Unity Shader</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/Unity/" class="post-category" target="_blank">
                                Unity
                            </a>
                        
                            <a href="/categories/Unity/Unity-Shader/" class="post-category" target="_blank">
                                Unity Shader
                            </a>
                        
                    </div>
                    
                </div>
            </div>

            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>Publish Date:&nbsp;&nbsp;
                    2019-08-19
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>Word Count:&nbsp;&nbsp;
                        1.3k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>Read Times:&nbsp;&nbsp;
                        8 Min
                    </div>
                    
                
				
				
            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Last time, we’ve talked about what a surface shader is, and what ingredients assemble a surface shader. And this time, we are going to put it into use to learn about making some simple effects. Before this, let’s go through some fundamental concepts of basic lighting.</p>
<p>&nbsp;</p>
<h3 id="Ambient-Lighting"><a href="#Ambient-Lighting" class="headerlink" title="Ambient Lighting"></a>Ambient Lighting</h3><p>In the real world, even when you’re in a dark environment with no lights on, the objects around you may not look completely dark. This is because there are always some lights from far away in the real world, like moon or some distant lights. To simulate this, we have to give an object an <strong>constant</strong> ambient color. However, this is just a simple simulation which doesn’t take into account the bounce of lights. Actually, when a light beam hits an object, it breaks into three parts:</p>
<ul>
<li>One is directly reflected by the object. </li>
<li>Another penetrates into the object and bounces between the molecules inside, and finally finds another way out.</li>
<li>The last penetrates into the object and its energy is exhausted while bouncing, and is ultimately absorbed.</li>
</ul>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/7de14d1ec0db67fda1a9f760bae9000f.png" alt></p>
<p>I defintely dont’t want to  get deep into physics, so I only offer these simplified statements based on my understanding. The lighting model includes these is what we call <code>Global Illumination</code>, which is way beyond our range.</p>
<p>&nbsp;</p>
<h3 id="Diffuse-Lighting"><a href="#Diffuse-Lighting" class="headerlink" title="Diffuse Lighting"></a>Diffuse Lighting</h3><p>Simply saying, the diffuse lighting gives an object a color that is mixed by the object basic color and light color. In the picture above, it is the second type of subdivisions. The intensity of diffuse lighting, seemingly the brightness of the color, is affected by the angle between the fragment’s normal vector and the light ray vector.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/9521185f58016300a424271b086accf5.png" alt title="From LearnOpenGL.com"></p>
<p>The commonsense is that the smaller the angle is, the brighter the color is. How should we do to measure the angle? Here we apply the dot product of the normalized versions of these two vectors. The lighting equation will look like this:</p>
<p>$$ Diffuse = BasicColor \times (\vec N \cdot \vec V_{light}) \times LightColor  $$</p>
<p>&nbsp;</p>
<h3 id="Specular-Lighting"><a href="#Specular-Lighting" class="headerlink" title="Specular Lighting"></a>Specular Lighting</h3><!--Think about this: it's a sunny day, you stand by the side of a lake. What does the lake surface look like with intensive sunlight casted on it? It depends on what angle you look at it from. If you look down to the water right by your side, it must be very clear; if you look at the water far away from you, it looks reflective and shiny. This is called `Fresnel Reflection`.-->

<!--![](https://ww1.yunjiexi.club/2019/08/19/f5a0961121b9ac7b32258821541a9ab7.jpg)-->
<p>Specular lighting generates a highlight at where the light ray is reflected. Like diffuse lighting, it also depends on fragment normal and the light ray vector, more directly the reflected light vector. Additionally, it involves a viewing vector.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/f9526b2dd82e4777f9af3e99af423fc7.png" alt title="From LearnOpenGL.com"></p>
<p>The specular light equation will look like this:</p>
<p>$$ Specular = K_s \times LightColor \times (\vec V_{view} \cdot \vec V_{reflected})^{shininess} $$</p>
<blockquote>
<p>This is used in a lighting model called <code>Phong</code>. There is another optimized version called <code>Blinn-Phong</code> which differs a little. We will be talking about them in another article concerning variable lightings.</p>
</blockquote>
<hr>
<p>&nbsp;</p>
<h2 id="Our-First-Shader"><a href="#Our-First-Shader" class="headerlink" title="Our First Shader"></a>Our First Shader</h2><p>Now let’s get our hands moving!</p>
<ul>
<li>Create a standard surface shader.</li>
<li>Define some properties we need.</li>
</ul>
<pre class=" language-cpp"><code class="language-cpp">
Properties <span class="token punctuation">{</span>
    <span class="token function">_Color</span><span class="token punctuation">(</span><span class="token string">"Color"</span><span class="token punctuation">,</span> Color<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">_AmbientColor</span><span class="token punctuation">(</span><span class="token string">"Ambient Color"</span><span class="token punctuation">,</span> Color<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">_Smoothness</span><span class="token punctuation">(</span><span class="token string">"Smoothness"</span><span class="token punctuation">,</span> <span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.5</span>
<span class="token punctuation">}</span>

Subshader <span class="token punctuation">{</span>
    CGPROGRAM

    float4 _Color<span class="token punctuation">;</span>
    float4 _AmbientColor<span class="token punctuation">;</span>
    half _Smoothness<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// This is the way Unity calls the "shininess"</span>

    ENDCG
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Modify the surface funtion.</li>
</ul>
<pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">surf</span> <span class="token punctuation">(</span>Input IN<span class="token punctuation">,</span> inout SurfaceOutputStandard o<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    fixed4 c <span class="token operator">=</span> _Color <span class="token operator">+</span> _AmbientColor<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>Albedo <span class="token operator">=</span> c<span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>Smoothness <span class="token operator">=</span> _Smoothness<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>Alpha <span class="token operator">=</span> c<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Now we can see some cool staff! The shiny spot is the reflection of the light source, a sun simulation.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/80ce4036f6b8eb951ff4be6602ddc3ba.png" alt></p>
<p>And if we decrease the <strong>Smoothness</strong>, we can see the shiny spot expanding and blurring. Also, the overall reflection diminishes, you can barely see the sky box reflection.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/16500d39fde6d66eb3736c9761c68a46.png" alt></p>
<p>&nbsp;</p>
<h3 id="Custom-Lighting"><a href="#Custom-Lighting" class="headerlink" title="Custom Lighting"></a>Custom Lighting</h3><p>Now you may have a question: where are the lighting equations we’ve talked about?</p>
<p>We don’t need any of them here because we are using Unity build-in lighting model for the surface shader. We just provide data, and Unity will do the math. However, we can still attest these equations by ourselves, because Unity allows us to define our own custom lighting model in the surface shader.</p>
<ul>
<li>Your custom lighting function name should start with <strong>Lighting</strong>. And the usage is just like the build-in lighting model.</li>
</ul>
<pre class=" language-cpp"><code class="language-cpp"><span class="token macro property">#<span class="token directive keyword">pragma</span> surface surf Custom</span>

float4 <span class="token function">LightingCustom</span> <span class="token punctuation">(</span>SurfaceOutput s<span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span></code></pre>
<ul>
<li>Custom lighting function use <code>SurfaceOutput</code> struct.</li>
</ul>
<p>First of all, define properties we need.</p>
<pre class=" language-cpp"><code class="language-cpp">Properties <span class="token punctuation">{</span>
    <span class="token function">_Color</span><span class="token punctuation">(</span><span class="token string">"Color"</span><span class="token punctuation">,</span> Color<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">_AmbientColor</span><span class="token punctuation">(</span><span class="token string">"Ambient Color"</span><span class="token punctuation">,</span> Color<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token function">_Smoothness</span><span class="token punctuation">(</span><span class="token string">"Smoothness"</span><span class="token punctuation">,</span> <span class="token function">Range</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token number">0.5</span>
<span class="token punctuation">}</span>

Subshader <span class="token punctuation">{</span>
    CGPROGRAM

    float4 _Color<span class="token punctuation">;</span>
    float4 _AmbientColor<span class="token punctuation">;</span>
    half _Smoothness<span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// This is the way Unity calls the "shininess"</span>

    ENDCG
<span class="token punctuation">}</span></code></pre>
<p>Since ambient color is constant and doesn’t interact with lights, we can simply assign it. Bind the <code>Smoothness</code> with our <code>_Smoothness</code>, and preset the <code>Specular</code>.</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token keyword">void</span> <span class="token function">surf</span> <span class="token punctuation">(</span>Input IN<span class="token punctuation">,</span> inout SurfaceOutput o<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    fixed4 c <span class="token operator">=</span> _Color <span class="token operator">+</span> _AmbientColor<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>Albedo <span class="token operator">=</span> c<span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>Smoothness <span class="token operator">=</span> _Smoothness<span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>Specular <span class="token operator">=</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
    o<span class="token punctuation">.</span>Alpha <span class="token operator">=</span> c<span class="token punctuation">.</span>a<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Now use the lighting equations we learned to finish our custom lighting function.</p>
<pre class=" language-cpp"><code class="language-cpp"><span class="token comment" spellcheck="true">// The lightDir and viewDir have defined by Unity, you can directly grab them and use</span>
float4 <span class="token function">LightingCustom</span><span class="token punctuation">(</span>SurfaceOutput s<span class="token punctuation">,</span> float3 lightDir<span class="token punctuation">,</span> float3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">// Diffuse</span>
    <span class="token comment" spellcheck="true">// Use "max" to prevent the dot product from being negative</span>
    <span class="token comment" spellcheck="true">// The "_LightColor0" is defined by Unity</span>
    float3 diff <span class="token operator">=</span> s<span class="token punctuation">.</span>Albedo <span class="token operator">*</span> <span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">dot</span><span class="token punctuation">(</span>lightDir<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">*</span> _LightColor0<span class="token punctuation">.</span>rgb<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Specular</span>
    <span class="token comment" spellcheck="true">// The reflected light vector is -L - 2 * (-L · N) * N, and do not forget to normalize it</span>
    float3 reflected <span class="token operator">=</span> <span class="token function">normalize</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir <span class="token operator">-</span> <span class="token number">2</span> <span class="token operator">*</span> <span class="token function">dot</span><span class="token punctuation">(</span><span class="token operator">-</span>lightDir<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float3 spec <span class="token operator">=</span> _LightColor0<span class="token punctuation">.</span>rgb <span class="token operator">*</span> <span class="token function">pow</span><span class="token punctuation">(</span><span class="token function">max</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token function">dot</span><span class="token punctuation">(</span>viewDir<span class="token punctuation">,</span> reflected<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> s<span class="token punctuation">.</span>Specular <span class="token operator">*</span> <span class="token number">128.0</span><span class="token punctuation">)</span> <span class="token operator">*</span> s<span class="token punctuation">.</span>Gloss<span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Final result</span>
    float4 c<span class="token punctuation">;</span>
    c<span class="token punctuation">.</span>rgb <span class="token operator">=</span> diff <span class="token operator">+</span> spec<span class="token punctuation">;</span>
    c<span class="token punctuation">.</span>a <span class="token operator">=</span> s<span class="token punctuation">.</span>Alpha<span class="token punctuation">;</span>
    <span class="token keyword">return</span> c<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>Apply it and have a look!</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/518d4528368171ebffb36d0aac1d269f.png" alt></p>
<p>Change the smoothness!</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/220b446a3b601efc50b94d63a36cbedf.png" alt></p>
<hr>
<p>&nbsp;</p>
<h2 id="Reflection"><a href="#Reflection" class="headerlink" title="Reflection"></a>Reflection</h2><p>We’ve done a great job, but it still looks not right. Our sphere is not reflecting the surrounding environment. We only make it reflect the light to form specular effect.</p>
<p>The most realistic way to simulate reflection is to apply global illumination, taking indirect lights into account. But this is very costly, sometimes it may cost you hours to render which is definitely not we want. Fortunately, there are indeed some ways to supplant GI. One of them is cube map: bake the environment onto a cube map, and then use object’s reflected vectors to sample the cube map.</p>
<p>&nbsp;</p>
<h3 id="Cubemap"><a href="#Cubemap" class="headerlink" title="Cubemap"></a>Cubemap</h3><p>Using cube map to simulate reflection just need a few changes.</p>
<p>First, we add a cube property.</p>
<pre class=" language-cpp"><code class="language-cpp">Properties
<span class="token punctuation">{</span>
    <span class="token function">_Cube</span><span class="token punctuation">(</span><span class="token string">"Cube Map"</span><span class="token punctuation">,</span> Cube<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

Subshader
<span class="token punctuation">{</span>
    CGPROGRAM

    samplerCUBE _Cube<span class="token punctuation">;</span>

    ENDCG
<span class="token punctuation">}</span>
</code></pre>
<p>Then we figure out the reflected vector. The environment reflected on the sphere changes as we change our viewpoints, so this time, different from above, we calculate reflected vector based on viewing vector and normals.</p>
<pre class=" language-cpp"><code class="language-cpp">float4 <span class="token function">LightingCustom</span><span class="token punctuation">(</span>SurfaceOutput s<span class="token punctuation">,</span> float3 lightDir<span class="token punctuation">,</span> float3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment" spellcheck="true">// Reflect</span>
    float3 refl <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>viewDir<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
<p>Sample the cube map and synthesize the color.</p>
<pre class=" language-cpp"><code class="language-cpp">float4 <span class="token function">LightingCustom</span><span class="token punctuation">(</span>SurfaceOutput s<span class="token punctuation">,</span> float3 lightDir<span class="token punctuation">,</span> float3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment" spellcheck="true">// Reflect</span>
    float3 refl <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>viewDir<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float3 ref <span class="token operator">=</span> <span class="token function">texCUBE</span><span class="token punctuation">(</span>_Cube<span class="token punctuation">,</span> refl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Final result</span>
    float4 c<span class="token punctuation">;</span>
    c<span class="token punctuation">.</span>rgb <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>diff <span class="token operator">+</span> spec<span class="token punctuation">,</span> ref <span class="token operator">+</span> spec<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Gloss<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
<p>Let’s apply a cube map and have a look!</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/d993db578b3dd78e530c02e0a4ddd614.png" alt></p>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/5830da6fadfdc90fb9cc390e89b48e9e.png" alt></p>
<blockquote>
<p>This cube map lacks a bottom face.</p>
</blockquote>
<p>&nbsp;</p>
<h3 id="Reflection-Probe"><a href="#Reflection-Probe" class="headerlink" title="Reflection Probe"></a>Reflection Probe</h3><p>Reflection probe is much easier than simple cube map. We don’t have to assign a cube map to every material any more.</p>
<pre class=" language-cpp"><code class="language-cpp">float4 <span class="token function">LightingCustom</span><span class="token punctuation">(</span>SurfaceOutput s<span class="token punctuation">,</span> float3 lightDir<span class="token punctuation">,</span> float3 viewDir<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>

    <span class="token comment" spellcheck="true">// Reflect</span>
    float3 refl <span class="token operator">=</span> <span class="token function">reflect</span><span class="token punctuation">(</span><span class="token operator">-</span>viewDir<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Normal<span class="token punctuation">)</span><span class="token punctuation">;</span>
    float3 ref <span class="token operator">=</span> <span class="token function">texCUBE</span><span class="token punctuation">(</span>_Cube<span class="token punctuation">,</span> refl<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Reflection probe</span>
    half4 cube <span class="token operator">=</span> <span class="token function">UNITY_SAMPLE_TEXCUBE</span><span class="token punctuation">(</span>unity_SpecCube0<span class="token punctuation">,</span> refle<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">// Final result</span>
    float4 c<span class="token punctuation">;</span>
    c<span class="token punctuation">.</span>rgb <span class="token operator">=</span> <span class="token function">lerp</span><span class="token punctuation">(</span>diff <span class="token operator">+</span> spec<span class="token punctuation">,</span> cube <span class="token operator">+</span> spec<span class="token punctuation">,</span> s<span class="token punctuation">.</span>Gloss<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span></code></pre>
<p><img src="https://ww1.yunjiexi.club/2019/08/19/6d1101bd8e2395aa95c54984f558279a.png" alt></p>
<p>It’s still not that good, but we are much closer!</p>
<hr>
<p>&nbsp;</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>Surface shader is amazing, isn’t it? You can easily achieve some photorealistic effects with it. And if you want some special effects, you are free to define your own lighting model. It’s really gorgeous and appealing! We talked about a basic lighting model called <strong>Phong</strong> and learn several related lighting equations. In the future, we will meet some other lighting models as well, they are all attractive! Additionally, two simple reflection simulations were proposed, we will go through more about reflection in the future. See you!</p>
<hr>
<p>&nbsp;</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] Unity 2018 Shaders and Effects Cookbook 3rd Edition - John P. Doran and Alan Zucconi</p>
<p>[2] <a href="https://docs.unity3d.com/Manual/SL-SurfaceShaders.html" target="_blank" rel="noopener">Unity Documentation</a></p>

            </div>
            <hr/>

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone, qq, weibo, douban"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            


        </div>
    </div>

    

    

    

    

    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;Previous</div>
            <div class="card">
                <a href="/CG2-Lighting.html">
                    <div class="card-image">
                        
                        <img src="https://ww1.yunjiexi.club/2019/07/27/nrWej.jpg" class="responsive-img" alt="Computer Graphics Review#2 - Lighting 1 of 2">
                        
                        <span class="card-title">Computer Graphics Review#2 - Lighting 1 of 2</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            Computer graphics is a sub-field of computer science which focuses on visual contents. Here we mainly refer to the 3D aspect, and discard 2D aspect like image processing, etc.
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2019-08-19
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/OpenGL/" class="post-category" target="_blank">
                                    OpenGL
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Computer-Graphics/" target="_blank">
                        <span class="chip bg-color">Computer Graphics</span>
                    </a>
                    
                    <a href="/tags/OpenGL/" target="_blank">
                        <span class="chip bg-color">OpenGL</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                Next&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/UnityShaderDev1.html">
                    <div class="card-image">
                        
                        <img src="https://ww1.yunjiexi.club/2019/07/30/nRzLN.png" class="responsive-img" alt="Unity Surface Shader#1 - First Meet">
                        
                        <span class="card-title">Unity Surface Shader#1 - First Meet</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            In Unity, a shader determines how an object, to which this shader is attached, would be rendered. And we are going to talk about how to create our own custom shaders.
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2019-08-17
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/Unity/" class="post-category" target="_blank">
                                    Unity
                                </a>
                            
                            <a href="/categories/Unity/Unity-Shader/" class="post-category" target="_blank">
                                    Unity Shader
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/Unity/" target="_blank">
                        <span class="chip bg-color">Unity</span>
                    </a>
                    
                    <a href="/tags/Unity-Shader/" target="_blank">
                        <span class="chip bg-color">Unity Shader</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>



    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;TOC</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="/libs/tocbot/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h2, h3, h4'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h2, h3, h4').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

<footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            &copy;<a href="https://github.com/PokhoOfSCUT" target="_blank">Rhys Chen</a>.

           
                &nbsp;<i class="fa fa-area-chart"></i>&nbsp;站点总字数:&nbsp;
                <span class="white-color">14k</span>
            

            
			
        </div>
        <div class="col s12 m4 l4 social-link ">
    <a href="https://github.com/PokhoOfSCUT" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>



    <a href="mailto:xkxkxhxh1@outlook.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>



    <a href="tencent://AddContact/?fromId=50&fromSubId=1&subcmd=all&uin=787802624" class="tooltipped" data-tooltip="QQ联系我: 787802624" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>


</div>
    </div>
</footer>

<div class="progress-bar"></div>


<!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;Search</span>
            <input type="search" id="searchInput" name="s" placeholder="Please enter a search keyword"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
<!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>


<script src="/libs/materialize/materialize.min.js"></script>
<script src="/libs/masonry/masonry.pkgd.min.js"></script>
<script src="/libs/aos/aos.js"></script>
<script src="/libs/scrollprogress/scrollProgress.min.js"></script>
<script src="/libs/lightGallery/js/lightgallery-all.min.js"></script>
<script src="/js/matery.js"></script>

<!-- Global site tag (gtag.js) - Google Analytics -->



    <script src="/libs/others/clicklove.js"></script>



</body>
</html>