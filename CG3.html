<!DOCTYPE html>





<html class="theme-next pisces use-motion" lang="en">
<head>
  <meta charset="UTF-8">
<meta name="generator" content="Hexo 3.9.0">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Lobster:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    save_scroll: true,
    copycode: {"enable":true,"show_result":true,"style":"flat"},
    fancybox: false,
    mediumzoom: true,
    lazyload: false,
    pangu: false,
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: 'search.xml',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="In recent 3D games, you can barely see those poor-shaded props or scenes. They are reaching more and more photorealistic since players now hold a higher standard and the rendering technique has develo">
<meta name="keywords" content="Computer Graphics,OpenGL">
<meta property="og:type" content="article">
<meta property="og:title" content="Computer Graphics Review#2 - Lighting 2 of 2">
<meta property="og:url" content="http://PokhoOfSCUT.github.io/CG3.html">
<meta property="og:site_name" content="Rhys&#39;s">
<meta property="og:description" content="In recent 3D games, you can barely see those poor-shaded props or scenes. They are reaching more and more photorealistic since players now hold a higher standard and the rendering technique has develo">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/09de3044e3848c766efa8599711d2e1c.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/0396206cefbf6d01de3e11b896f67549.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/853b7d94518429f935bedd650787edde.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/b4d7351fbb1870822d5417c6f0904e7e.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/f86e5a1db8ebf85f091819e37fc6af19.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/7e0c3e88ed6b9447de5fcb44d075320e.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/d3dc7234c156a8ac9e40f48f0e57d1a3.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/e6337d3182318a194fa1109251dbf9d9.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/853b7d94518429f935bedd650787edde.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/a45ac0bdf558d97dfeaf37208dc39d18.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/25a799dfa08709cb908ce0d269af2c85.png">
<meta property="og:image" content="https://ww1.yunjiexi.club/2019/08/26/72c18072ac770568970d7a677dfe4e71.png">
<meta property="og:updated_time" content="2019-11-12T09:02:47.517Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Computer Graphics Review#2 - Lighting 2 of 2">
<meta name="twitter:description" content="In recent 3D games, you can barely see those poor-shaded props or scenes. They are reaching more and more photorealistic since players now hold a higher standard and the rendering technique has develo">
<meta name="twitter:image" content="https://ww1.yunjiexi.club/2019/08/26/09de3044e3848c766efa8599711d2e1c.png">
  <link rel="canonical" href="http://PokhoOfSCUT.github.io/CG3">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Computer Graphics Review#2 - Lighting 2 of 2 | Rhys's</title>
  








  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  <div class="container sidebar-position-left">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Rhys's</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">Welcome to Rhys's</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-schedule">
      
    

    <a href="/schedule/" rel="section"><i class="menu-item-icon fa fa-fw fa-calendar"></i> <br>Schedule</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-sitemap">
      
    

    <a href="/sitemap.xml" rel="section"><i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br>Sitemap</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content page-post-detail">
            

  <div id="posts" class="posts-expand">
    
    <div class="reading-progress-bar"></div>

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://PokhoOfSCUT.github.io/CG3.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Rhys Chen">
      <meta itemprop="description" content="Do my best, so I cannot blame myself for anything.">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Rhys's">
    </span>
      <header class="post-header">

        
          <h1 class="post-title" itemprop="name headline">Computer Graphics Review#2 - Lighting 2 of 2

            
          </h1>
        

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              
                
              

              <time title="Created: 2019-08-25 22:28:28" itemprop="dateCreated datePublished" datetime="2019-08-25T22:28:28+08:00">2019-08-25</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-12 17:02:47" itemprop="dateModified" datetime="2019-11-12T17:02:47+08:00">2019-11-12</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">In</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Graphics/" itemprop="url" rel="index"><span itemprop="name">Computer Graphics</span></a></span>

                
                
              
            </span>
          

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>In recent 3D games, you can barely see those poor-shaded props or scenes. They are reaching more and more photorealistic since players now hold a higher standard and the rendering technique has developed a lot. A significant part of this is <code>PBR</code>, which simulates the physical properties of light in rendering to achieve realistic effects.</p>
<a id="more"></a>

<hr>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><p>Last time, we talked about several commonly used lighting models in computer graphics. They are experience-based models, creating simple and unreal lighting effects. And this time we are going to learn about a much more realistic rendering technique: <code>PBR, Physically-Based Rendering</code>. It is more or less based on some theories that resembles the physical principles in the real world, but still, it is just an approximation of lighting in the real world. And this is why we call it physically-based rendering instead of physcal rendering. For a PBR lighting model, there are 3 preconditions:</p>
<ul>
<li>Microfacet Model</li>
<li>Energy Conservation</li>
<li>Physically-based BRDF</li>
</ul>
<p>We will go through these one by one.</p>
<hr>
<p>&nbsp;</p>
<h2 id="Microfacet-Model"><a href="#Microfacet-Model" class="headerlink" title="Microfacet Model"></a>Microfacet Model</h2><p>This theory descirbes that any surface at a microscopic scale can be described by tiny little perfectly reflective mirrors called <code>microfacets</code>. According to the roughness of a surface the alignment of these tiny mirrors can differ quite a lot:</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/09de3044e3848c766efa8599711d2e1c.png" alt title="From LearnOpenGL.com"></p>
<p>The effect of these tiny-like mirror alignments is that when specifically talking about specular lighting/reflection the incoming light rays are more likely to scatter along completely different directions on rougher surfaces, resulting in a more widespread specular reflection. In contrast, on a smooth surface the light rays are more likely to reflect in roughly the same direction, giving us smaller and sharper reflections:</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/0396206cefbf6d01de3e11b896f67549.png" alt title="From LearnOpenGL.com"></p>
<p>No surface is completely smooth on a microscopic level, but seeing as these microfacets are small enough that we can’t make a distinction between them on a per-pixel basis we statistically approximate the surface’s microfacet roughness given a roughness parameter. Based on the roughness of a surface we can calculate the ratio of microfacets roughly aligned to some vector $\vec h$. This vector $\vec h$ is the halfway vector that sits halfway between the light $\vec l$ and view $\vec v$ vector. We’ve discussed the halfway vector before in the blinn-phong lighting model which is calculated as the sum of $\vec l$ and $\vec v$ divided by its length:</p>
<p>$$ \vec h = \frac{\vec l + \vec v}{|\vec l + \vec v|} $$</p>
<p>The more the microfacets are aligned to the halfway vector, the sharper and stronger the specular reflection. Together with a roughness parameter that varies between 0 and 1 we can statistically approximate the alignment of the microfacets.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/853b7d94518429f935bedd650787edde.png" alt title="From LearnOpenGL.com"></p>
<hr>
<p>&nbsp;</p>
<h2 id="Energy-Conservation"><a href="#Energy-Conservation" class="headerlink" title="Energy Conservation"></a>Energy Conservation</h2><p>Energy conservation describes that the energy of outgoing light rays never exceed that of the incoming light rays. As we can see in the picture above, as the roughness inceases,  the area of reflectance increases but the brightness goes down.</p>
<p>For energy conservation to hold we need to make a clear distinction between diffuse and specular light. We’ve covered this last time when we talked about the scattering. When a light ray hits a surface, it breaks into a reflection part and a refraction part. The reflection part is the part that doesn’t go inside the object, which we call specular specular lighting. While the refraction part goes under the surface and is partially absorbed, which we call diffuse lighting.</p>
<p>Physically, we are going to have a deeper look at the “<strong>partial absorption</strong>“. A light ray can be regarded as a beam of energy that keeps moving forward until it loses all its energy, and it loses its energy by colliding with other molecules. All materials consist of innumerable tiny molecules, and these molecules absorb all or part of a light ray’s energy when they collide and turn them into heat. Generally, not all energy is absorbed, and the light ray keeps moving until the energy is totally aborbed or finds another way out the surface. If the light ray is not completely absorbed and finally moves out, it participates in forming the surface’s color, and this is what we call diffuse color.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/b4d7351fbb1870822d5417c6f0904e7e.png" alt title="From LearnOpenGL.com"></p>
<p>Furthermore, for metallic materials, all refracted lights are completely absorbed and not rescattered out of the surface. So, metallica materials don’t dispaly a diffuse color.</p>
<p>Based on the distinction between the reflection and refraction, we can conclude that the reflected light and the refracted light are mutually exclusive. We can calculate the total energy of reflected light and the rest goes to refracted light.</p>
<hr>
<p>&nbsp;</p>
<h2 id="Reflectance-Equation"><a href="#Reflectance-Equation" class="headerlink" title="Reflectance Equation"></a>Reflectance Equation</h2><p>To thoroughly understand the reflectance equation, we have to involve a little bit of <strong>Radiometry</strong>.</p>
<p>$$ L_o(p,\ w_o) = \int_{\Omega}^{ }{f_r(p,\ w_i,\ w_o)L_i(p,\ w_i)n \cdot w_idw_i} $$</p>
<p>This does look very scary at the beginning, but as we gradually analyze it, I believe we will figure it out. We go through some terms first.</p>
<p><strong>Radiant flux</strong>: radiant flux $\Phi$ is the transmitted energy of a light source measured in Watts. Light is a collective sum of energy over multiple different wavelengths, each wavelength associated with a particular visible color. The emitted energy of a light source are therefore be thought of as a function of all its different wavelengths. The radiant flux measures the total area of this function of different wavelengths. Directly taking this measure of wavelengths as input in computer graphics is slightly impractical so we often make the simplification of representing radiant flux not as a function of varing wavelength strengths, but as a light color triplet encoded as RGB. This encoding does come at quite a loss of information, but this is generally negligible for visual aspects.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/f86e5a1db8ebf85f091819e37fc6af19.png" alt title="From LearnOpenGL.com"></p>
<p><strong>Solid angle</strong>: solid angle is represented by $\omega$, describing the size or area of a shape projected onto a unit sphere. The area of the projected shape onto this unit sphere is known as the <code>solid angle</code>. You can visualize the solid angle as a direction with volume:</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/7e0c3e88ed6b9447de5fcb44d075320e.png" alt title="From LearnOpenGL.com"></p>
<p>Thinking of being an observer at the center of this unit sphere and looking in the direction of the shape, and the size of the silhouette you make out of it is the solid angle.</p>
<p><strong>Radiant intensity</strong>: radiant intensity measures the amount of radiant flux per solid angle or the strength of a light source over a projected area onto the unit sphere. For instance, given an omnidirectional light that radiates equally in all directions the radiant intensity can give us its energy over a specific area:</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/d3dc7234c156a8ac9e40f48f0e57d1a3.png" alt title="From LearnOpenGL.com"></p>
<p>The equation to describe the radiant intensity is defined as follows:</p>
<p>$$ I = \frac{d\Phi}{d\omega} $$</p>
<p>Where $I$ is the radiant flux $\Phi$ over the solid angle $\omega$.</p>
<p>With knowledge of radiant flux, radiant intensity and the solid angle we can finally describe the equation for radiance, which is described as the total observed energy over an area $A$ over the solid angle $\omega$ of a light of radiant intensity $\Phi$:</p>
<p>$$ L = \frac{d^2\Phi}{dAdwcos\theta} $$</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/e6337d3182318a194fa1109251dbf9d9.png" alt title="From LearnOpenGL.com"></p>
<p>If we consider the solid angle $\omega$ and the area $A$ to be infinitely small, we can us radiance to measure the flux of a single ray of light hitting a single point. This relation allows us to calculate the radiance of a single light ray influencing a single fragment. We effectively translate the solid angle $\omega$ into a direction vector $\omega$, and $A$ into a point $p$. This way we can directly use radiance in our shaders to calculate a single light ray’s per-fragment contribution.</p>
<p>In fact, when it comes to radiance we generally care about all incoming light onto a point p which is the sum of all radiance known as irradiance. With knowledge of both radiance and <code>irradiance</code> we can get back to the reflectance equation:</p>
<p>$$ L_o(p,\ w_o) = \int_{\Omega}^{ }{f_r(p,\ w_i,\ w_o)L_i(p,\ w_i)n \cdot w_idw_i} $$</p>
<p>We now know that L in the render equation represents the radiance of some point p and some incoming infinitely small solid angle ωi which can be thought of as an incoming direction vector $ω_i$. Remember that $cos\theta$ scales the energy based on the light’s incident angle to the surface which we find in the reflectance equation as $n\cdot ω_i$. The reflectance equation calculates the sum of reflected radiance $L_o(p,\ ω_o)$ of a point $p$ in direction $ω_o$ which is the outgoing direction to the viewer. Or to put it differently: $L_o$ measures the reflected sum of the lights’ irradiance onto point $p$ as viewed from $ω_o$.</p>
<hr>
<p>&nbsp;</p>
<h2 id="BRDF"><a href="#BRDF" class="headerlink" title="BRDF"></a>BRDF</h2><p>The <code>BRDF</code>, or <code>bidirectional reflective distribution function</code> is a function that takes as input the incoming light direction $w_i$, the outgoing view direction $w_o$, the surface normal $n$ and a surface parameter $a$ that represents the microsuface’s roughness. The BRDF approximates how much each individual light ray ωi contributes to the final reflected light of an opaque surface given its material properties.</p>
<p>A BRDF approximates the material’s reflective and refractive properties based on the previously discussed microfacet theory. For a BRDF to be physically plausible it has to respect the law of energy conservation i.e. the sum of reflected light should never exceed the amount of incoming light. Technically, Blinn-Phong is considered a BRDF taking the same ωi and ωo as inputs. However, Blinn-Phong is not considered physically based as it doesn’t adhere to the energy conservation principle. There are several physically based BRDFs out there to approximate the surface’s reaction to light. However, almost all real-time render pipelines use a BRDF known as the <code>Cook-Torrance BRDF</code>.</p>
<p>The Cook-Torrance BRDF contains both a diffuse and specular part:</p>
<p>$$ f_r = k_df_{lambert} + k_sf_{cook-torrance} $$</p>
<p>Here $k_d$ is the earlier mentioned ratio of incoming light energy that gets refracted with $k_s$ being the ratio that gets reflected. The left side of the BRDF states the diffuse part of the equation denoted here as $f_{lambert}$. This is known as <code>lambertian diffuse</code> similar to what we used for diffuse shading which is a constant factor denoted as:</p>
<p>$$ f_{lambert} = \frac{c}{\pi} $$</p>
<p>With $c$ being the albedo or surface color (think of the diffuse surface texture). The divide by $\pi$ is there to normalize the diffuse light as the earlier denoted integral that contains the BRDF is scaled by $\pi$.</p>
<div class="note warning">
            <p>You might wonder how this Lambertian diffuse relates to the diffuse term we’ve been using before: the surface color multiplied by the dot product between the surface’s normal and the light direction. The dot product is still there, but moved out of the BRDF as we find $n\cdot ω_i$ at the end of the $L_o$ integral.</p>
          </div>

<p>There exist different equations for the diffuse part of the BRDF which tend to look more realistic, but are also more computationally expensive. As concluded by Epic Games however, the Lambertian diffuse is sufficient enough for most real-time rendering purposes.</p>
<p>The specular part of the BRDF is a bit more advanced and is described as:</p>
<p>$$ f_{cook-torrance} = \frac{DFG}{4(w_o\cdot n)(w_i\cdot n)} $$</p>
<p>The Cook-Torrance specular BRDF consists of three functions and a normalization factor in the denominator. Each of the D, F and G symbols represent a type of function that approximates a specific part of the surface’s reflective properties. These are defined as the normal <strong>D</strong>istribution function, the <strong>F</strong>resnel equation and the <strong>G</strong>eometry function:</p>
<ul>
<li><p><strong>Normal distribution function</strong>: approximates the amount of the surface’s microfacets are aligned to the halfway vector influenced by the roughness of the surface; this is the primary function approximating the microfacets.</p>
</li>
<li><p><strong>Geometry function</strong>: describes the self-shadowing property of the microfacets. When a surface is relatively rough the surface’s microfacets can overshadow other microfacets thereby reducing the light the surface reflects.</p>
</li>
<li><p><strong>Fresnel equation</strong>: the Fresnel equation describes the ratio of surface reflection at different surface angles.</p>
</li>
</ul>
<p>Each of these functions is an approximation of their physics equivalents and you’ll find more than one version of each one that aims to approximate the underlying physics; some more realistic, others more efficient. It is perfectly allowed to pick whatever approximated version of these functions you want to use. Brian Karis from Epic Games did a good deal of research on the multiple types of approximations here. We’re going to pick the same functions used by Epic Game’s Unreal Engine 4 which are the Trowbridge-Reitz GGX for D, the Fresnel-Schlick approximation for F and the Smith’s Schlick-GGX for G.</p>
<p>&nbsp;</p>
<h3 id="Normal-Distribution-Function"><a href="#Normal-Distribution-Function" class="headerlink" title="Normal Distribution Function"></a>Normal Distribution Function</h3><p>The normal distribution function D statistically approximates the relative surface area of microfacets exactly aligned to the halfway vector h. There are a multitude of NDFs defined that statistically approximate the general alignment of the microfacets given some roughness parameter and the one we’ll be using is known as the Trowbridge-Reitz GGX:</p>
<p>$$ NDF_{GGXTR}(n,\ h,\ \alpha) = \frac{\alpha^2}{\pi((n\cdot h)^2(\alpha^2 - 1) + 1)^2} $$</p>
<p>Here $h$ is the halfway vector to measure against the surface’s microfacets, with $\alpha$ being a measure of the surface’s roughness. If we take $h$ as the halfway vector between the surface normal and light direction over varying roughness parameters we get the following visual result:</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/853b7d94518429f935bedd650787edde.png" alt title="From LearnOpenGL.com"></p>
<p>&nbsp;</p>
<h3 id="Geometry-Function"><a href="#Geometry-Function" class="headerlink" title="Geometry Function"></a>Geometry Function</h3><p>The geometry function statistically approximates the relative surface area where its micro surface-details overshadow each other causing light rays to be occluded.</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/a45ac0bdf558d97dfeaf37208dc39d18.png" alt title="From LearnOpenGL.com"></p>
<p>Similar to the NDF, the Geometry function takes a material’s roughness parameter as input with rougher surfaces having a higher probability of overshadowing microfacets. The geometry function we will use is a combination of the GGX and Schlick-Beckmann approximation known as Schlick-GGX:</p>
<p>$$ G_{SchlickGGX}(n,\ v,\ k) = \frac{n\cdot v}{(n\cdot v)(1 - k) + k} $$</p>
<p>Here $k$ is a remapping of $\alpha$ based on whether we’re using the geometry function for either direct lighting or IBL lighting:</p>
<p>$$ k_{direct} = \frac{(\alpha + 1)^2}{8} $$</p>
<p>$$ k_{IBL} = \frac{\alpha^2}{2}$$</p>
<p>To effectively approximate the geometry we need to take account of both the view direction and the light direction vector. We can take both into account using <code>Smith&#39;s method</code>:</p>
<p>$$G(n,\ v,\ l,\ k) = G_{SchlickGGX}(n,\ v,\ k)G_{SchlickGGX}(n,\ l,\ k)$$</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/25a799dfa08709cb908ce0d269af2c85.png" alt title="From LearnOpenGL.com"></p>
<p>The geometry function is a multiplier between $[0.0, 1.0]$ with white or $1.0$ measuring no microfacet shadowing and black or $0.0$ complete microfacet shadowing.</p>
<p>&nbsp;</p>
<h3 id="Fresnel-Equation"><a href="#Fresnel-Equation" class="headerlink" title="Fresnel Equation"></a>Fresnel Equation</h3><p>The Fresnel equation describes the ratio of light that gets reflected over the light that gets refracted, which varies over the angle we’re looking at a surface. The moment light hits a surface, based on the surface to view angle the Fresnel equation tells us the percentage of light that gets reflected. From this ratio of reflection and the energy conservation principle we can directly obtain the refracted portion of light from its remaining energy.</p>
<p>Every surface or material has a level of base <code>reflectivity</code> when looking straight at its surface, but when looking at the surface from an angle all reflections become more apparent compared to the surface’s base reflectivity. You can check this for yourself by looking at your presumably wooden/metallic desk which has a certain level of base reflectivity from a perpendicular view angle, but by looking at your desk from an almost 90 degree angle you’ll see the reflections become much more apparent. All surfaces theoretically fully reflect light if seen from perfect 90-degree angles. This phenomenon is known as <code>Fresnel</code> and is described by the Fresnel equation.</p>
<p>The Fresnel equation is a rather complex equation, but luckily the Fresnel equation can be approximated using the Fresnel-Schlick approximation:</p>
<p>$$ F_{Schlick}(h,\ v,\ F_0) = F_0 + (1 - F_0)(1 - (h\cdot v))^5 $$</p>
<p>$F_0$ represents the base reflectivity of the surface, which we calculate using something called the indices of refraction or IOR and as you can see on a sphere surface, the more we look towards the surface’s grazing angles the stronger the Fresnel and thus the reflections:</p>
<p><img src="https://ww1.yunjiexi.club/2019/08/26/72c18072ac770568970d7a677dfe4e71.png" alt title="From LearnOpenGL.com"></p>
<p>There are a few subtleties involved with the Fresnel equation. One is that the Fresnel-Schlick approximation is only really defined for dielectric or non-metal surfaces. For conductor surfaces, calculating the base reflectivity using their indices of refraction doesn’t properly hold and we need to use a different Fresnel equation for conductors altogether. As this is inconvenient we further approximate by pre-computing the surface’s response at normal incidence, at a 0 degree angle as if looking directly onto a surface, and interpolate this value based on the view angle as per the Fresnel-Schlick approximation such that we can use the same equation for both metals and non-metals.</p>
<pre class=" language-cpp"><code class="language-cpp">vec3 F0 <span class="token operator">=</span> <span class="token function">vec3</span><span class="token punctuation">(</span><span class="token number">0.04</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
F0 <span class="token operator">=</span> <span class="token function">mix</span><span class="token punctuation">(</span>F0<span class="token punctuation">,</span> surfaceColor<span class="token punctuation">.</span>rgb<span class="token punctuation">,</span> metalness<span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<hr>
<p>&nbsp;</p>
<h2 id="Cook-Torrance-Reflectance-Equation"><a href="#Cook-Torrance-Reflectance-Equation" class="headerlink" title="Cook-Torrance Reflectance Equation"></a>Cook-Torrance Reflectance Equation</h2><p>With every component of the Cook-Torrance BRDF described we can include the physically based BRDF into the now final reflectance equation:</p>
<p>$$L_o(p,\ w_o) = \int_{\Omega}^{ }{(k_d\frac{c}{\pi} + k_s\frac{DFG}{4(w_o\cdot n)(w_i\cdot n)})L_i(p,\ w_i)n\cdot w_idw_i}$$</p>
<p>This equation is however not fully mathematically correct. You may remember that the Fresnel term $F$ represents the ratio of light that gets reflected on a surface. This is effectively our ratio $k_s$, meaning the specular part of the reflectance equation implicitly contains the reflectance ratio $k_s$. Given this, our final final reflectance equation becomes:</p>
<p>$$L_o(p,\ w_o) = \int_{\Omega}^{ }{(k_d\frac{c}{\pi} + \frac{DFG}{4(w_o\cdot n)(w_i\cdot n)})L_i(p,\ w_i)n\cdot w_idw_i}$$</p>
<hr>
<p>&nbsp;</p>
<h2 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h2><p>[1] <a href="https://learnopengl.com" target="_blank" rel="noopener">LearnOpenGL</a></p>

    </div>

    
    
    
        
      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/Computer-Graphics/" rel="tag"><i class="fa fa-tag"></i> Computer Graphics</a>
            
              <a href="/tags/OpenGL/" rel="tag"><i class="fa fa-tag"></i> OpenGL</a>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/CG2-Lighting.html" rel="next" title="Computer Graphics Review#2 - Lighting 1 of 2">
                  <i class="fa fa-chevron-left"></i> Computer Graphics Review#2 - Lighting 1 of 2
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/UnityLab1.html" rel="prev" title="Unity Lab - Non-Euclidean Space">
                  Unity Lab - Non-Euclidean Space <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            Overview
          </li>
        </ul>
      

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Rhys Chen</p>
  <div class="site-description motion-element" itemprop="description">Do my best, so I cannot blame myself for anything.</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">categories</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">tags</span>
        
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/PokhoOfSCUT" title="GitHub &rarr; https://github.com/PokhoOfSCUT" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:xkxkxhxh1@outlook.com" title="E-Mail &rarr; mailto:xkxkxhxh1@outlook.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



        </div>
      </div>
      <!--noindex-->
        <div class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
            
            
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Overview"><span class="nav-number">1.</span> <span class="nav-text">Overview</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Microfacet-Model"><span class="nav-number">2.</span> <span class="nav-text">Microfacet Model</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Energy-Conservation"><span class="nav-number">3.</span> <span class="nav-text">Energy Conservation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reflectance-Equation"><span class="nav-number">4.</span> <span class="nav-text">Reflectance Equation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#BRDF"><span class="nav-number">5.</span> <span class="nav-text">BRDF</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Normal-Distribution-Function"><span class="nav-number">5.1.</span> <span class="nav-text">Normal Distribution Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Geometry-Function"><span class="nav-number">5.2.</span> <span class="nav-text">Geometry Function</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Fresnel-Equation"><span class="nav-number">5.3.</span> <span class="nav-text">Fresnel Equation</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Cook-Torrance-Reflectance-Equation"><span class="nav-number">6.</span> <span class="nav-text">Cook-Torrance Reflectance Equation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Reference"><span class="nav-number">7.</span> <span class="nav-text">Reference</span></a></li></ol></div>
            

          </div>
        </div>
      <!--/noindex-->
      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rhys Chen</span>
</div>

        








        
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>

    

  </div>

  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>
  <script src="/lib/mediumzoom/medium-zoom.min.js"></script>
  <script src="/lib/reading_progress/reading_progress.js"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

<script src="/js/utils.js?v=7.3.0"></script>
  <script src="/js/motion.js?v=7.3.0"></script>


  <script src="/js/affix.js?v=7.3.0"></script>
  <script src="/js/schemes/pisces.js?v=7.3.0"></script>


<script src="/js/next-boot.js?v=7.3.0"></script>




  




























  

  
    
      <script type="text/x-mathjax-config">

  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$', '$'], ['\\(', '\\)'] ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    },
    TeX: {
      equationNumbers: {
        autoNumber: 'AMS'
      }
    }
  });

  MathJax.Hub.Register.StartupHook('TeX Jax Ready', function() {
    MathJax.InputJax.TeX.prefilterHooks.Add(function(data) {
      if (data.display) {
        var next = data.script.nextSibling;
        while (next && next.nodeName.toLowerCase() === '#text') {
          next = next.nextSibling;
        }
        if (next && next.nodeName.toLowerCase() === 'br') {
          next.parentNode.removeChild(next);
        }
      }
    });
  });

  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i = 0; i < all.length; i += 1) {
      element = document.getElementById(all[i].inputID + '-Frame').parentNode;
      if (element.nodeName.toLowerCase() == 'li') {
        element = element.parentNode;
      }
      element.classList.add('has-jax');
    }
  });
</script>
<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mathjax@2/MathJax.js?config=TeX-AMS-MML_HTMLorMML', function() {
    MathJax.Hub.Typeset();
  }, window.MathJax);
</script>

    
  

  

  


  
  <script src="/js/scrollspy.js?v=7.3.0"></script>
<script src="/js/post-details.js?v=7.3.0"></script>


</body>
</html>
